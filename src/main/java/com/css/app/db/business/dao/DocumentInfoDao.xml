<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.css.app.db.business.dao.DocumentInfoDao">

	<select id="queryObject" resultType="com.css.app.db.business.entity.DocumentInfo">
		select * from DB_DOCUMENT_INFO where ID = #{value}
	</select>

	<select id="queryList" resultType="com.css.app.db.business.entity.DocumentInfo">
		select t.*,c.under_depts,d.* from DB_DOCUMENT_INFO t
		left join (
		select s.INFO_ID,s.USER_NAME as leader_name,s.LEADER_COMMENT as leader_content,s.CREATED_TIME as leader_time,
           row_number() over(partition by s.info_id order by b.sort asc) as dNum from DB_DOCUMENT_SZPS s inner join DB_ROLE_SET b on s.USER_ID=b.USER_ID order by b.sort asc
		) d on t.id = d.info_id
		left join (select distinct info_id,listagg(sub_dept_name || nvl2(DECODE(undertaker_name,'',null,'NULL',null,undertaker_name),'/' || undertaker_name ||nvl2(DECODE(undertaker_phone,'',null,'NULL',null,undertaker_phone),'('||undertaker_phone||')',null),null), ',') within group(order by b.sort,created_time desc) over(partition by info_id) under_depts from DB_SUB_DOC_INFO a inner join BASE_APP_ORGAN b
        on a.sub_dept_id=b.id) c on t.id = c.info_id
        <if test="leaderId !=null and leaderId !=''">
        inner join (select info_id from (select info_id,row_number() over(partition by info_id order by created_time) as num from DB_DOCUMENT_SZPS where USER_ID=#{leaderId}
	        <if test="psStartDate != null and psStartDate != ''">
				and CREATED_TIME >= #{psStartDate} 
			</if>
			<if test="psEndDate != null and psEndDate != ''">
				and CREATED_TIME &lt;= #{psEndDate} 
			</if>) where num=1) v on t.id=v.info_Id 
        </if>	
		<if test="orgid != null and orgid != ''" >
			left join DB_SUB_DOC_INFO  dadi on t.id=dadi.INFO_ID
		</if>
		 where (d.dNum = 1 or d.dNum is null) 
		 <if test="orgid != null and orgid != '' ">
			and dadi.SUB_DEPT_ID=#{orgid}
		</if>
		<if test='docStatus == "1"'>
			and t.STATUS=0
		</if>
		<if test='docStatus == "2"'>
			and t.STATUS &gt; 0
		</if>
		<if test="hasUpdate != null"> 
			and t.LATEST_REPLY !='' and t.LATEST_REPLY is not null and t.id not in(select INFO_ID from DB_DOCUMENT_READ where USER_ID=#{loginUserId})
		</if>
		<if test="search != null and search != ''">
			and (t.DOC_TITLE like '%'||#{search}||'%' or t.BANJIAN_NUMBER  like '%'||#{search}||'%')
		</if>
		<if test="title != null and title != ''">
			and t.DOC_TITLE like '%'||#{title}||'%'
		</if>
		<if test="period != null and period != ''">
			and t.PERIOD like '%'||#{period}||'%'
		</if>
		<if test="year != null">
			and to_char(t.FIRST_ZB_TIME) like '%'||#{year}||'%'
		</if>
		<if test="state != null and state != ''">
			and t.STATUS=#{state}
		</if>
		<if test="type != null">
			and t.DOC_TYPE_ID=#{type}
		</if>
		<if test="startDate != null and startDate != ''">
			and d.leader_time>= #{startDate} 
		</if>
		<if test="endDate != null and endDate != ''">
			and d.leader_time &lt;= #{endDate} 
		</if>
		<if test="zbStartDate != null and zbStartDate != ''">
			and t.FIRST_ZB_TIME>= #{zbStartDate}
		</if>
		<if test="zbEndDate != null and zbEndDate != ''">
			and t.FIRST_ZB_TIME &lt;= #{zbEndDate}
		</if>
		<if test="latestReply != null and latestReply != ''">
				and (t.LATEST_REPLY !='' or t.LATEST_REPLY is not null)
		</if>
		<if test="isnotuserid != null">
			and (t.sz_read_ids not like '%'||#{isnotuserid}||'%' or t.sz_read_ids is null)
		</if>
		<choose>
			<when test="sort == 'desc'">order by t.BANJIAN_NUMBER desc</when>
			<when test="sort == 'asc'"> order by t.BANJIAN_NUMBER ASC</when>
			<otherwise>order by t.STATUS asc,IFNULL(t.LATEST_REPLY_TIME, t.FIRST_ZB_TIME) desc,t.CREATED_TIME desc</otherwise>
		</choose>
		
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
	<select id="queryPersonList" resultType="com.css.app.db.business.entity.DocumentInfo">
		WITH V_RESULT as(select SUB_ID from 
		(select SUB_ID, row_number() over(partition by SUB_ID order by CREATED_TIME desc) as num
		from DB_SUB_DOC_TRACKING where 1=1 
		<if test="deptId !=null and deptId !=''">
			and REC_DEPT_ID = #{deptId}
		</if>
		<if test="loginUserId !=null and loginUserId !=''">
			and RECEIVER_ID = #{loginUserId}
		</if>)
		where num =1),
		
		V_RESULT1 as(select SUB_ID from 
		(select SUB_ID, row_number() over(partition by SUB_ID order by CREATED_TIME desc) as num
		from DB_DOC_XB_INFO where 1=1 AND PUBLISH_FLAG = '0'
		<if test="loginUserId !=null and loginUserId !=''">
			and RECEIVER_ID = #{loginUserId}
		</if>) 
		where num =1)
		
		select t.*,c.under_depts,d.* from DB_DOCUMENT_INFO t
		left join DB_SUB_DOC_INFO  dadi on t.id=dadi.INFO_ID inner join (select * from V_RESULT union select * from V_RESULT1) a on dadi.id= a.sub_id
		left join (select s.INFO_ID,s.USER_NAME as leader_name,s.LEADER_COMMENT as leader_content,s.CREATED_TIME as leader_time,
        row_number() over(partition by s.info_id order by b.sort asc) as dNum from DB_DOCUMENT_SZPS s inner join DB_ROLE_SET b on s.USER_ID=b.USER_ID order by b.sort asc
		) d on t.id = d.info_id
		left join (select distinct info_id,listagg(sub_dept_name || nvl2(DECODE(undertaker_name,'',null,'NULL',null,undertaker_name),'/' || undertaker_name ||nvl2(DECODE(undertaker_phone,'',null,'NULL',null,undertaker_phone),'('||undertaker_phone||')',null),null), ',') within group(order by f.sort,created_time desc) over(partition by info_id) under_depts from DB_SUB_DOC_INFO e inner join BASE_APP_ORGAN f
        on e.sub_dept_id=f.id) c on t.id = c.info_id
        <if test="leaderId !=null and leaderId !=''">
        	inner join (select info_id from (select info_id,row_number() over(partition by info_id order by created_time) as num from DB_DOCUMENT_SZPS where USER_ID=#{leaderId}
        	<if test="psStartDate != null and psStartDate != ''">
				and CREATED_TIME >= #{psStartDate} 
			</if>
			<if test="psEndDate != null and psEndDate != ''">
				and CREATED_TIME &lt;= #{psEndDate} 
			</if>) where num=1) v on t.id=v.info_Id
        </if>	 
        where (d.dNum = 1 or d.dNum is null) 
		<if test='docStatus == "1"'>
			and t.STATUS=0
		</if>
		<if test='docStatus == "2"'>
			and t.STATUS &gt; 0
		</if>
		<if test="hasUpdate != null"> 
			and t.LATEST_REPLY !='' and t.LATEST_REPLY is not null and t.id not in(select INFO_ID from DB_DOCUMENT_READ where USER_ID=#{loginUserId})
		</if>
		<if test="search != null and search != ''">
			and (t.DOC_TITLE like '%'||#{search}||'%' or t.BANJIAN_NUMBER  like '%'||#{search}||'%')
		</if>
		<if test="title != null and title != ''">
			and t.DOC_TITLE like '%'||#{title}||'%'
		</if>
		<if test="period != null and period != ''">
			and t.PERIOD like '%'||#{period}||'%'
		</if>
		<if test="year != null">
			and to_char(t.FIRST_ZB_TIME) like '%'||#{year}||'%'
		</if>
		<if test="state != null and state != ''">
			and t.STATUS=#{state}
		</if>
		<if test="type != null">
			and t.DOC_TYPE_ID=#{type}
		</if>
		<if test="startDate != null and startDate != ''">
			and d.leader_time>= #{startDate} 
		</if>
		<if test="endDate != null and endDate != ''">
			and d.leader_time &lt;= #{endDate} 
		</if>
		<if test="zbStartDate != null and zbStartDate != ''">
			and t.FIRST_ZB_TIME>= #{zbStartDate}
		</if>
		<if test="zbEndDate != null and zbEndDate != ''">
			and t.FIRST_ZB_TIME &lt;= #{zbEndDate}
		</if>
		<if test="isnotuserid != null">
			and (t.sz_read_ids not like '%'||#{isnotuserid}||'%' or t.sz_read_ids is null)
		</if>
		order by t.STATUS asc,IFNULL(t.LATEST_REPLY_TIME, t.FIRST_ZB_TIME) desc,t.CREATED_TIME desc 
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	<select id="queryDicByType" resultType="com.css.app.db.config.entity.DocumentDic">
		select dic.*,nvl(s.num,0) hasUpdateNum from DB_DOCUMENT_DIC dic	
		left join(select DOC_TYPE_ID, count(1) as num
		from "DB_DOCUMENT_INFO" t
		<if test="orgId != null and orgId != '' ">
			left join DB_SUB_DOC_INFO a on t.ID=a.INFO_ID
		</if>
		<if test="deptId !=null and deptId !=''">
			left join DB_SUB_DOC_INFO a on t.ID=a.INFO_ID
			inner join ((select SUB_ID from 
			(select SUB_ID, row_number() over(partition by SUB_ID order by CREATED_TIME desc) as num
			from DB_SUB_DOC_TRACKING where REC_DEPT_ID = #{deptId})
			where num =1)
			union( select SUB_ID from DB_DOC_XB_INFO nn where nn.PUBLISH_FLAG = '0' and nn.RECEIVER_ID = #{loginUserId} and #{loginUserId}!=nn.UNDERTAKER_ID and nn.RECEIVER_DEPT_ID = #{deptId}) 
			) b on a.ID = b.SUB_ID
		</if>
		<if test="loginUserId !=null and loginUserId !=''">
			left join DB_SUB_DOC_INFO a on t.ID=a.INFO_ID
			inner join ((select SUB_ID from 
			(select SUB_ID, row_number() over(partition by SUB_ID order by CREATED_TIME desc) as num
			from DB_SUB_DOC_TRACKING where RECEIVER_ID = #{loginUserId})
			where num =1)
			union( select SUB_ID from DB_DOC_XB_INFO nn where nn.PUBLISH_FLAG = '0' and nn.RECEIVER_ID = #{loginUserId} and #{loginUserId} != nn.UNDERTAKER_ID) 
			) b on a.ID = b.SUB_ID
		</if>
		where t.LATEST_REPLY !='' and t.LATEST_REPLY is not null
		<if test="orgId != null and orgId != '' ">
			and a.SUB_DEPT_ID=#{orgId}
		</if>
		<if test="year != null">
			and to_char(t.FIRST_ZB_TIME) like '%'||#{year}||'%'
		</if>
		and t.id not in ( select INFO_ID from DB_DOCUMENT_READ where USER_ID=#{userId}) group by t.DOC_TYPE_ID )s	
		on dic.value = s.DOC_TYPE_ID
		where dic.DIC_TYPE = #{docType} order by value asc
	</select>
	<!-- 统计图首长批示详情页列表 -->
	<select id="queryStatisticsList" resultType="com.css.app.db.business.entity.DocumentInfo">
		select * from (
		select db.* ,row_number() over(partition by db.id order by ps.created_time) as num from "DB_DOCUMENT_INFO" db left join "DB_DOCUMENT_SZPS" ps on db.id=ps.info_id where db.status>0
		<if test="leaderId !=null and leaderId !=''">
			and ps.USER_ID=#{leaderId}
		</if>
		<if test="status !=null and status !=''">
			and db.status=#{status}
		</if>
		<if test="type !=null and type !=''">
			and db.DOC_TYPE_ID=#{type}
		</if>
		<if test="yearOrMonth !=null and yearOrMonth !=''">
			and ps.CREATED_TIME like '%'||#{yearOrMonth}||'%'
		</if>
		<if test="startDate !=null and startDate !=''">
		    and ps.CREATED_TIME >= #{startDate}
		</if>
		<if test="endDate !=null and endDate !=''">
			and ps.CREATED_TIME &lt;= #{endDate}
		</if>
		) t left join (select distinct info_id,listagg(sub_dept_name || nvl2(DECODE(undertaker_name,'',null,'NULL',null,undertaker_name),'/' || undertaker_name ||nvl2(DECODE(undertaker_phone,'',null,'NULL',null,undertaker_phone),'('||undertaker_phone||')',null),null), ',') within group(order by b.sort,created_time desc) over(partition by info_id) under_depts from DB_SUB_DOC_INFO a inner join BASE_APP_ORGAN b
        on a.sub_dept_id=b.id) c on t.id = c.info_id
		where t.num=1 order by t.STATUS asc,t.CREATED_TIME desc
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	<!-- 统计图首长批示查询 -->
	<select id="queryLeaderStatistics" resultType="com.css.app.db.business.dto.LeaderStatisticsDto">
	 select b.user_id as leaderId, b.user_name as leaderName,nvl(t.blzCount, 0) as blzCount,nvl(t.ybjCount, 0) as ybjCount,nvl(t.ctlsCount, 0) as ctlsCount
     from  DB_ROLE_SET b  
	 left join (select shu.user_id as leaderId,shu.user_name as leaderName,isnull(sum(shu.blz), 0) as blzCount,isnull(sum(shu.bj), 0) as ybjCount,isnull(sum(shu.ctls), 0) as ctlsCount  
		from (select ddi.user_id,ddi.user_name,
			(case when ddi.STATUS='1' then count(ddi.STATUS) else 0 end ) as blz,
			(case when ddi.STATUS='2' then count(ddi.STATUS) else 0 end ) as bj,
			(case when ddi.STATUS='3' then count(ddi.STATUS) else 0 end ) as ctls
		         from(
		             select ps.user_id,ps.user_name,ps.info_id,db.status, row_number() over(partition by ps.user_name,ps.info_id order by ps.CREATED_TIME) as num from "DB_DOCUMENT_SZPS" ps left join "DB_DOCUMENT_INFO" db on ps.info_id=db.id where db.status>0 
		             <if test="yearOrMonth !=null and yearOrMonth !=''">
		             	and ps.CREATED_TIME like '%'||#{yearOrMonth}||'%'
		             </if>
		             <if test="startDate != null and startDate != ''">
						and ps.CREATED_TIME >= #{startDate} 
					 </if>
					 <if test="endDate != null and endDate != ''">
						and ps.CREATED_TIME &lt;= #{endDate} 
					 </if>
		             )  ddi where num = '1' group by ddi.user_id,ddi.user_name,ddi.STATUS
	         )shu  group by shu.user_id,shu.user_name) t on b.USER_ID=t.leaderId where b.ROLE_FLAG ='1' order by b.sort asc
	</select>

	<!--根据年度获取每个状态的数量   CREATED_TIME暂为年度时间-->
	<select id="queryListByYear" resultType="map">
	select sum(blz+bj+ctls) as total,sum(blz) as blz,sum(bj) as bj,sum(ctls) as ctls from (
		select 
         (case when ddi.STATUS='1' then count(ddi.STATUS) else 0 end ) as blz,
	        (case when ddi.STATUS='2' then count(ddi.STATUS) else 0 end ) as bj,
	        (case when ddi.STATUS='3' then count(ddi.STATUS) else 0 end ) as ctls       
        from DB_DOCUMENT_INFO  ddi
		where 1=1 and FIRST_ZB_TIME is not null
		<if test="year != null">
			and to_char(ddi.FIRST_ZB_TIME) like '%'||#{year}||'%'
		</if>
		
		
		group by ddi.STATUS
		order by ddi.STATUS asc
		)
	</select>
		<!--根据年度获取每个状态的数量   CREATED_TIME暂为年度时间-->
	<select id="queryListByOrgYear" resultType="map">
	select org.ID,org.NAME as dwname,
		isnull(shu.blz,0) as blz,
        isnull(shu.bj,0)  as bj,
        isnull(shu.ctls,0) as ctls
		 from BASE_APP_ORGAN org
		left join
	
	(
		select d.SUB_DEPT_ID as id,d.SUB_DEPT_NAME as dwname,sum(blz) as blz,sum(bj) as bj,sum(ctls) as ctls from (
			select dadi.SUB_DEPT_ID ,dadi.SUB_DEPT_NAME ,
	        (case when ddi.STATUS='1' then count(ddi.STATUS) else 0 end ) as blz,
	        (case when ddi.STATUS='2' then count(ddi.STATUS) else 0 end ) as bj,
	        (case when ddi.STATUS='3' then count(ddi.STATUS) else 0 end ) as ctls
	        
	        from DB_DOCUMENT_INFO  ddi
			left join (select SUB_DEPT_ID,SUB_DEPT_NAME,INFO_ID,CREATED_TIME,DOC_STATUS
	                          from DB_SUB_DOC_INFO)  dadi
			on ddi.id=dadi.INFO_ID
			where 1=1 and ddi.FIRST_ZB_TIME is not null
			<if test="year != null">
				and to_char(dadi.CREATED_TIME) like '%'||#{year}||'%'
			</if>
			group by ddi.STATUS,dadi.SUB_DEPT_ID,dadi.SUB_DEPT_NAME
			order by ddi.STATUS asc
			)d  GROUP by d.SUB_DEPT_ID,d.SUB_DEPT_NAME
	)shu on org.id=shu.id where org.PARENT_ID='root'
	</select>
	
	<select id="queryListByDicType" resultType="map">
	select dic.TEXT as name,dic.value as type,ifnull(shu.num,0) as num
		 from DB_DOCUMENT_DIC dic
		left join
	
	(
			select DOC_TYPE_ID,count(DOC_TYPE_ID) as num
	        from DB_DOCUMENT_INFO  
			where 1=1 and FIRST_ZB_TIME is not null
			<if test="search != null and search != ''">
				and (DOC_TITLE like '%'||#{search}||'%' or BANJIAN_NUMBER  like '%'||#{search}||'%')
			</if>
			<if test="status != null and status != ''">
				and STATUS=#{status}
			</if>
			<if test="status2 != null and status2 != ''">
				and STATUS > #{status2}
			</if>
			<if test="latestreply != null and latestreply != ''">
				and (LATEST_REPLY !='' or LATEST_REPLY is not null)
			</if>
			<if test="isnotuserid != null">
			and (sz_read_ids not like '%'||#{isnotuserid}||'%' or sz_read_ids is null)
			</if>
			GROUP by DOC_TYPE_ID
	)shu on dic.value=shu.DOC_TYPE_ID where dic.DIC_TYPE='document_type' 
	<if test="type != null and type != ''">
				and dic.VALUE=#{type}
			</if>
	order by dic.value asc
	</select>
	
	
	
	<select id="queryListByDicStu" resultType="map">
	select  dic.TEXT as name,
        isnull(sum(shu.bj +shu.ctls), 0)          as bj  ,
        isnull(sum(shu.blz+shu.bj+shu.ctls), 0) as total
		 from DB_DOCUMENT_DIC dic
		left join
	
	(
			select ddi.DOC_TYPE_ID,
	        (case when ddi.STATUS='1' then count(ddi.STATUS) else 0 end ) as blz,
	        (case when ddi.STATUS='2' then count(ddi.STATUS) else 0 end ) as bj,
	        (case when ddi.STATUS='3' then count(ddi.STATUS) else 0 end ) as ctls
	        
	        from DB_DOCUMENT_INFO  ddi where  ddi.FIRST_ZB_TIME is not null
	        <if test="search != null and search != ''">
			and (ddi.DOC_TITLE like '%'||#{search}||'%' or ddi.BANJIAN_NUMBER  like '%'||#{search}||'%')
			</if>
			group by ddi.DOC_TYPE_ID,ddi.STATUS
			
	)shu on dic.value=shu.DOC_TYPE_ID where dic.DIC_TYPE='document_type' group by dic.DIC_TYPE,dic.text  
	</select>
	
	<select id="queryListByDicStutas" resultType="map">
	select ddi.DOC_TYPE_ID,
	        (case when ddi.STATUS='1' then count(ddi.STATUS) else 0 end ) as blz,
	        (case when ddi.STATUS='2' then count(ddi.STATUS) else 0 end ) as bj,
	        (case when ddi.STATUS='3' then count(ddi.STATUS) else 0 end ) as ctls
	         
	        
	        from DB_DOCUMENT_INFO  ddi where  ddi.FIRST_ZB_TIME is not null
	        and ddi.DOC_TYPE_ID=#{type}
			group by ddi.DOC_TYPE_ID,ddi.STATUS 
	</select>
	
	
	
 	<select id="queryTotal" resultType="int">
		select count(*) from DB_DOCUMENT_INFO 
	</select>
	 
 	<select id="getMaxSecurity" resultType="java.lang.String">
 	SELECT TEXT FROM DB_DOCUMENT_DIC WHERE DIC_TYPE='SECURITY_CLASSIFICATION' AND VALUE=(
	SELECT MAX(SECURITY_ID) FROM DB_DOCUMENT_INFO WHERE ID IN
	<foreach item="id" collection="array" open="(" separator="," close=")">
		#{id}
	</foreach>
	)
   </select>
	 <select id="queryInfoByParam" resultType="com.css.app.db.business.entity.DocumentInfo">
		 select * from DB_DOCUMENT_INFO where 1=1
		 <if test="typeId != null and typeId != ''">
		  and DOC_TYPE_ID=#{typeId}
		 </if>
		 order by CREATED_TIME desc
	 </select>

	<insert id="save" parameterType="com.css.app.db.business.entity.DocumentInfo">
		insert into DB_DOCUMENT_INFO
		(
			"ID", 
			"DOC_TITLE", 
			"SECURITY_ID", 
			"SECURITY_CLASSIFICATION", 
			"URGENCY_ID", 
			"URGENCY_DEGREE", 
			"DOC_CODE", 
			"BANJIAN_NUMBER", 
			"USER_ID", 
			"USER_NAME", 
			"APPLY_TIME", 
			"PRINT_DATE", 
			"JOB_CONTENT", 
			"FIRST_ZB_TIME", 
			"SZ_READ_IDS", 
			"CUIBAN_FLAG", 
			"DOC_TYPE_ID", 
			"DOC_TYPE_NAME",
			"CREATED_TIME", 
			"REMARK",
			"STATUS",
			"FINISH_TIME",
			"LATEST_REPLY",
			"LATEST_SUB_DEPT",
			"LATEST_UNDERTAKER",
			"LATEST_REPLY_TIME",
			"PERIOD"
		)
		values
		(
			#{id}, 
			#{docTitle}, 
			#{securityId}, 
			#{securityClassification}, 
			#{urgencyId}, 
			#{urgencyDegree}, 
			#{docCode}, 
			#{banjianNumber}, 
			#{userId}, 
			#{userName}, 
			#{applyTime}, 
			#{printDate}, 
			#{jobContent}, 
			#{firstZbTime}, 
			#{szReadIds}, 
			#{cuibanFlag}, 
			#{docTypeId}, 
			#{docTypeName},
			#{createdTime},
			#{remark},
			#{status},
			#{finishTime},
			#{latestReply},
			#{latestSubDept},
			#{latestUndertaker},
			#{latestReplyTime},
			#{period}
		)
	</insert>
	 
	<update id="update" parameterType="com.css.app.db.business.entity.DocumentInfo">
		update DB_DOCUMENT_INFO 
		<set>
			<if test="docTitle != null">"DOC_TITLE" = #{docTitle}, </if>
			<if test="securityId != null">"SECURITY_ID" = #{securityId}, </if>
			<if test="securityClassification != null">"SECURITY_CLASSIFICATION" = #{securityClassification}, </if>
			<if test="urgencyId != null">"URGENCY_ID" = #{urgencyId}, </if>
			<if test="urgencyDegree != null">"URGENCY_DEGREE" = #{urgencyDegree}, </if>
			<if test="docCode != null">"DOC_CODE" = #{docCode}, </if>
			<if test="banjianNumber != null">"BANJIAN_NUMBER" = #{banjianNumber}, </if>
			<if test="period != null">"PERIOD" = #{period},</if>
			<if test="userId != null">"USER_ID" = #{userId}, </if>
			<if test="userName != null">"USER_NAME" = #{userName}, </if>
			<if test="applyTime != null">"APPLY_TIME" = #{applyTime}, </if>
			<if test="printDate != null">"PRINT_DATE" = #{printDate}, </if>
			<if test="jobContent != null">"JOB_CONTENT" = #{jobContent}, </if>
			<if test="firstZbTime != null">"FIRST_ZB_TIME" = #{firstZbTime}, </if>
			<if test="szReadIds != null">"SZ_READ_IDS" = #{szReadIds}, </if>
			<if test="cuibanFlag != null">"CUIBAN_FLAG" = #{cuibanFlag}, </if>
			<if test="docTypeId != null">"DOC_TYPE_ID" = #{docTypeId}, </if>
			<if test="docTypeName != null">"DOC_TYPE_NAME" = #{docTypeName}, </if>
			<if test="createdTime != null">"CREATED_TIME" = #{createdTime}, </if>
			<if test="remark != null">"REMARK" = #{remark},</if>
			<if test="status != null">"STATUS" = #{status},</if>
			<choose>
				<when test="finishTime == null">"FINISH_TIME" = null,</when>
				<otherwise>"FINISH_TIME" = #{finishTime},</otherwise>
			</choose>
			<if test="latestReply != null">"LATEST_REPLY" = #{latestReply},</if>
			<if test="latestSubDept != null">"LATEST_SUB_DEPT" = #{latestSubDept},</if>
			<if test="latestUndertaker != null">"LATEST_UNDERTAKER" = #{latestUndertaker},</if>
			<choose>
				<when test="latestReplyTime == null">"LATEST_REPLY_TIME" = null</when>
				<otherwise>"LATEST_REPLY_TIME" = #{latestReplyTime}</otherwise>
			</choose>
		</set>
		where ID = #{id}
	</update>
	<update id="updateDocumentInfoById" parameterType="com.css.app.db.business.entity.DocumentInfo">
		update DB_DOCUMENT_INFO 
		set 
		"DOC_TITLE" = #{docTitle}, "SECURITY_ID" = #{securityId}, "SECURITY_CLASSIFICATION" = #{securityClassification},
		"URGENCY_ID" = #{urgencyId},"URGENCY_DEGREE" = #{urgencyDegree},"DOC_CODE" = #{docCode},
		"BANJIAN_NUMBER" = #{banjianNumber},"PERIOD" = #{period},"USER_ID" = #{userId},"USER_NAME" = #{userName},
		"APPLY_TIME" = #{applyTime},"PRINT_DATE" = #{printDate},"JOB_CONTENT" = #{jobContent},"FIRST_ZB_TIME" = #{firstZbTime},
		"SZ_READ_IDS" = #{szReadIds}, "CUIBAN_FLAG" = #{cuibanFlag},"DOC_TYPE_ID" = #{docTypeId},"DOC_TYPE_NAME" = #{docTypeName},
		"CREATED_TIME" = #{createdTime},"REMARK" = #{remark},"STATUS" = #{status},"FINISH_TIME" = #{finishTime},"LATEST_REPLY" = #{latestReply},
		"LATEST_SUB_DEPT" = #{latestSubDept},"LATEST_UNDERTAKER" = #{latestUndertaker},"LATEST_REPLY_TIME" = #{latestReplyTime}
		where ID = #{id}
	</update>
	<delete id="delete">
		delete from DB_DOCUMENT_INFO where ID = #{value}
	</delete>
	
	<delete id="deleteBatch">
		delete from DB_DOCUMENT_INFO where ID in 
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>

</mapper>