<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.css.app.db.business.dao.DocXbInfoDao">

	<select id="queryObject" resultType="com.css.app.db.business.entity.DocXbInfo">
		select * from DB_DOC_XB_INFO where ID = #{value}
	</select>

	<select id="queryList" resultType="com.css.app.db.business.entity.DocXbInfo">
		select * from DB_DOC_XB_INFO 
		<where>
			<if test="subId != null and subId != ''">
			 	and SUB_ID = #{subId}
			</if>
			<if test="infoId != null and infoId != ''">
			 	and INFO_ID = #{infoId}
			</if>
			<if test="undertakerId != null and undertakerId != ''">
			 	and UNDERTAKER_ID = #{undertakerId}
			</if>
			<if test="receiverId != null and receiverId != ''">
			 	and RECEIVER_ID = #{receiverId}
			</if>
			<if test="offset != null and limit != null">
				limit #{offset}, #{limit}
			</if>
		</where>
	</select>
	
 	<select id="queryTotal" resultType="int">
		select count(*) from DB_DOC_XB_INFO 
	</select>
	
 	<select id="queryLastNewData" resultType="com.css.app.db.business.entity.DocXbInfo">
		select * from DB_DOC_XB_INFO where SUB_ID = #{0} and INFO_ID = {1} and UNDERTAKER_ID = #{2} ORDER BY FEED_BACK_TIME
	</select>
	
 	<select id="queryXbRecord" resultType="com.css.app.db.business.entity.DocXbInfo" parameterType="string">
<!-- 		select WM_CONCAT(RECEIVER_NAME) xieBanPersonNames,UNDERTAKER_NAME undertakerName, DEPT_NAME deptName, RECEIVER_DEPT_NAME receiverDeptName, CREATED_TIME createdTime  from DB_DOC_XB_INFO where INFO_ID = #{infoId}  group by UNDERTAKER_NAME, DEPT_NAME, CREATED_TIME, RECEIVER_DEPT_NAME
 -->		
 		select
	        WM_CONCAT(RECEIVER_NAME) xieBanPersonNames,
	        UNDERTAKER_NAME undertakerName            ,
	        DEPT_NAME deptName                        ,
	        RECEIVER_DEPT_NAME receiverDeptName       ,
	        to_date(CREATED_TIME,'yyyy-mm-dd HH24:mi:ss') CREATED_TIME 
		from
        	DB_DOC_XB_INFO
        where INFO_ID = #{infoId} 
		group by
	        UNDERTAKER_NAME,
	        DEPT_NAME ,
	        to_date(CREATED_TIME,'yyyy-mm-dd HH24:mi:ss'),
	        RECEIVER_DEPT_NAME
	</select>
	 
	<insert id="save" parameterType="com.css.app.db.business.entity.DocXbInfo">
		insert into DB_DOC_XB_INFO
		(
			"ID", 
			"INFO_ID", 
			"SUB_ID", 
			"UNDERTAKER_ID", 
			"UNDERTAKER_NAME", 
			"DEPT_ID",
			"DEPT_NAME",
			"RECEIVER_ID", 
			"RECEIVER_NAME", 
			"RECEIVER_DEPT_ID",
			"RECEIVER_DEPT_NAME",
			"CREATED_TIME"
		)
		values
		(
			#{id}, 
			#{infoId}, 
			#{subId}, 
			#{undertakerId}, 
			#{undertakerName}, 
			#{deptId},
			#{deptName},
			#{receiverId}, 
			#{receiverName}, 
			#{receiverDeptId},
			#{receiverDeptName},
			#{createdTime}
		)
	</insert>
	 
	<update id="update" parameterType="com.css.app.db.business.entity.DocXbInfo">
		update DB_DOC_XB_INFO 
		<set>
			<if test="infoId != null">"INFO_ID" = #{infoId}, </if>
			<if test="subId != null">"SUB_ID" = #{subId}, </if>
			<if test="undertakerId != null">"UNDERTAKER_ID" = #{undertakerId}, </if>
			<if test="undertakerName != null">"UNDERTAKER_NAME" = #{undertakerName}, </if>
			<if test="deptId != null">"DEPT_ID" = #{deptId}, </if>
			<if test="deptName != null">"DEPT_NAME" = #{deptName}, </if>
			<if test="receiverId != null">"RECEIVER_ID" = #{receiverId}, </if>
			<if test="receiverName != null">"RECEIVER_NAME" = #{receiverName}, </if>
			<if test="receiverDeptId != null">"RECEIVER_DEPT_ID" = #{receiverDeptId}, </if>
			<if test="receiverDeptName != null">"RECEIVER_DEPT_NAME" = #{receiverDeptName}, </if>
			<if test="createdTime != null">"CREATED_TIME" = #{createdTime} </if>
		</set>
		where ID = #{id}
	</update>
	
	<delete id="delete">
		delete from DB_DOC_XB_INFO where ID = #{value}
	</delete>
	
	<delete id="deleteBySubIdAndReceiverId">
		delete from DB_DOC_XB_INFO where SUB_ID = #{0} AND RECEIVER_ID = #{1}
	</delete>
	
	<delete id="deleteBatch">
		delete from DB_DOC_XB_INFO where ID in 
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>

</mapper>